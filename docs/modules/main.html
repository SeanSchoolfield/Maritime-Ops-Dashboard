

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>main &mdash; Maritime Operations Dashboard 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Maritime Operations Dashboard
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../backend.html">Backend API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../backend.html#main.connect_to_vessels"><code class="docutils literal notranslate"><span class="pre">connect_to_vessels()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../backend.html#main.welcome"><code class="docutils literal notranslate"><span class="pre">welcome()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../backend.html#main.weather"><code class="docutils literal notranslate"><span class="pre">weather()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../backend.html#main.users"><code class="docutils literal notranslate"><span class="pre">users()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../backend.html#main.decrypt_password"><code class="docutils literal notranslate"><span class="pre">decrypt_password()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../backend.html#main.add_user"><code class="docutils literal notranslate"><span class="pre">add_user()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../backend.html#main.login"><code class="docutils literal notranslate"><span class="pre">login()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../backend.html#main.filter_parser"><code class="docutils literal notranslate"><span class="pre">filter_parser()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../backend.html#main.get_filtered_vessels"><code class="docutils literal notranslate"><span class="pre">get_filtered_vessels()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../backend.html#main.get_filter_options"><code class="docutils literal notranslate"><span class="pre">get_filter_options()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../backend.html#main.add_vessel"><code class="docutils literal notranslate"><span class="pre">add_vessel()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../backend.html#main.query_metadata"><code class="docutils literal notranslate"><span class="pre">query_metadata()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../backend.html#main.predict_path"><code class="docutils literal notranslate"><span class="pre">predict_path()</span></code></a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Maritime Operations Dashboard</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">main</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for main</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">json</span><span class="w"> </span><span class="kn">import</span> <span class="n">loads</span><span class="p">,</span> <span class="n">dumps</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">HTTPException</span><span class="p">,</span> <span class="n">Query</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.responses</span><span class="w"> </span><span class="kn">import</span> <span class="n">JSONResponse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.middleware.cors</span><span class="w"> </span><span class="kn">import</span> <span class="n">CORSMiddleware</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">DBOperator</span><span class="w"> </span><span class="kn">import</span> <span class="n">DBOperator</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">linear_regression</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">linear_regression_2</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="c1"># CORS Middleware Setup</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
    <span class="n">CORSMiddleware</span><span class="p">,</span>
    <span class="n">allow_origins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>  <span class="c1"># Requests from frontend</span>
    <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
    <span class="n">allow_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
<span class="p">)</span>

<div class="viewcode-block" id="connect_to_vessels">
<a class="viewcode-back" href="../backend.html#main.connect_to_vessels">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">connect_to_vessels</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">DBOperator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Connects to the &#39;vessels&#39; table in the database.</span>

<span class="sd">    :return: DBOperator instance for interacting with the vessels table.</span>
<span class="sd">    :raises HTTPException: If connection fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">DBOperator</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s1">&#39;vessels&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;### Fast Server: Connected to vessels table&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">db</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;### Fast Server: Unable to connect to Vessels table&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Unable to connect to database.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="welcome">
<a class="viewcode-back" href="../backend.html#main.welcome">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">welcome</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles the root endpoint.</span>

<span class="sd">    :return: A welcome message with the current timestamp.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Message&quot;</span><span class="p">:</span> <span class="s2">&quot;Welcome to FastAPI!&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Retrieved&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
           <span class="p">}</span></div>


<div class="viewcode-block" id="weather">
<a class="viewcode-back" href="../backend.html#main.weather">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/weather/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">weather</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles the weather endpoint.</span>

<span class="sd">    :return: A weather message with the current timestamp.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Message&quot;</span><span class="p">:</span> <span class="s2">&quot;Weather!&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Retrieved&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
           <span class="p">}</span></div>


<div class="viewcode-block" id="users">
<a class="viewcode-back" href="../backend.html#main.users">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">users</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles the users endpoint.</span>

<span class="sd">    :return: A users message with the current timestamp.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Message&quot;</span><span class="p">:</span> <span class="s2">&quot;Getting users!&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Retrieved&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
           <span class="p">}</span></div>


<div class="viewcode-block" id="decrypt_password">
<a class="viewcode-back" href="../backend.html#main.decrypt_password">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">decrypt_password</span><span class="p">(</span><span class="n">encrypted_password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decrypts a password using AES encryption.</span>

<span class="sd">    :param encrypted_password: The base64-encoded encrypted password.</span>
<span class="sd">    :param secret_key: The encryption key used for decryption.</span>
<span class="sd">    :return: The decrypted password as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">encrypted_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encrypted_password</span><span class="p">)</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">secret_key</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_ECB</span><span class="p">)</span>
    <span class="n">decrypted_bytes</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decrypted_bytes</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="add_user">
<a class="viewcode-back" href="../backend.html#main.add_user">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/addUser&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add_user</span><span class="p">(</span><span class="n">formData</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a new user based on provided form data.</span>

<span class="sd">    :param formData: A dictionary containing user information.</span>
<span class="sd">    :return: The received form data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">formData</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">formData</span></div>


<div class="viewcode-block" id="login">
<a class="viewcode-back" href="../backend.html#main.login">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="n">formData</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Logs in a user based on provided form data.</span>

<span class="sd">    :param formData: A dictionary containing user credentials.</span>
<span class="sd">    :return: The received form data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">formData</span><span class="p">)</span>
    <span class="c1"># email = formData[&quot;email&quot;]</span>
    <span class="c1"># decrypted_password = decrypt_password(formData[&quot;password&quot;], secret_key=&quot;my-secret-key&quot;)</span>
    <span class="k">return</span> <span class="n">formData</span></div>

    

<div class="viewcode-block" id="filter_parser">
<a class="viewcode-back" href="../backend.html#main.filter_parser">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">filter_parser</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recursively generates query options from filter parameters.</span>
<span class="sd">    ### WARNING: Creates some duplicate queries when more than one attribute</span>
<span class="sd">    has more than 1 value. Pretty sure its cuz my recursive restraints suck. </span>
<span class="sd">    Shouldn&#39;t affect results since its a UNION query</span>

<span class="sd">    :param p: Dictionary containing filter criteria.</span>
<span class="sd">    :param result: List to store the resulting filter options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">v</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">q</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">filter_parser</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="n">x</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_filtered_vessels">
<a class="viewcode-back" href="../backend.html#main.get_filtered_vessels">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/vessels/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_filtered_vessels</span><span class="p">(</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Filter by vessel type&quot;</span><span class="p">),</span>
    <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Filter by country of origin&quot;</span><span class="p">),</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Filter by vessel status&quot;</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetches vessel data based on filters.</span>

<span class="sd">    :param type: Filter by vessel type.</span>
<span class="sd">    :param origin: Filter by country of origin.</span>
<span class="sd">    :param status: Filter by vessel status.</span>
<span class="sd">    :return: Filtered vessel data.</span>
<span class="sd">    :raises HTTPException: If database interaction fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">connect_to_vessels</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;retrieved&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="s2">&quot;privileges&quot;</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="n">permissions</span><span class="p">,</span>
            <span class="s2">&quot;attribuets&quot;</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span>
            <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="n">fetch_filter_options</span><span class="p">(),</span>
            <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error fetching metadata for vessels: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Assemble filters</span>
    <span class="n">types_list</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Include filters only if they have values</span>
    <span class="k">if</span> <span class="n">types_list</span><span class="p">:</span>
        <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">types_list</span>

    <span class="k">if</span> <span class="n">origin</span><span class="p">:</span>
        <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;flag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">origin</span>

    <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
        <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;current_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>

    <span class="c1"># Proceed with query if filters are present, otherwise return all vessels</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### Websocket: Filters:</span><span class="se">\n</span><span class="si">{</span><span class="n">filters</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>  <span class="c1"># If any filters are provided</span>
            <span class="n">queries</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">filter_parser</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">queries</span><span class="p">)</span>

            <span class="c1"># Remove duplicates from queries array</span>
            <span class="n">queries</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">{</span><span class="nb">tuple</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">}]</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### Websocket: query array:&quot;</span><span class="p">)</span>
            <span class="n">pprint</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span>

            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;payload&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Return all vessels if no filters are provided</span>
            <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;payload&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_table</span><span class="p">()</span>

        <span class="n">payload</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;payload&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">payload</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error fetching vessels: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="get_filter_options">
<a class="viewcode-back" href="../backend.html#main.get_filter_options">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/filters/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_filter_options</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetches available filter options for vessels.</span>

<span class="sd">    :return: A dictionary containing filter options.</span>
<span class="sd">    :raises HTTPException: If database interaction fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">connect_to_vessels</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">filter_options</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">fetch_filter_options</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;No filter options found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">filter_options</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error fetching filter options: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="add_vessel">
<a class="viewcode-back" href="../backend.html#main.add_vessel">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/vessels/add/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add_vessel</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a new vessel to the database.</span>

<span class="sd">    :param data: A dictionary containing vessel information.</span>
<span class="sd">    :return: A success message upon successful insertion.</span>
<span class="sd">    :raises HTTPException: If database interaction fails or required fields are missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">connect_to_vessels</span><span class="p">()</span>
    <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;country_of_origin&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">field</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">required_fields</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Missing required fields. Required fields are: </span><span class="si">{</span><span class="n">required_fields</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Vessel added successfully&quot;</span><span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error adding vessel: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="query_metadata">
<a class="viewcode-back" href="../backend.html#main.query_metadata">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/metadata/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">query_metadata</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetches metadata for spatial reference systems.</span>

<span class="sd">    :return: Metadata payload including privileges, entity count, and attributes.</span>
<span class="sd">    :raises HTTPException: If database interaction fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">operator</span> <span class="o">=</span> <span class="n">DBOperator</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="s1">&#39;spatial_ref_sys&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;### Fast Server: Unable connect to spatial_ref_sys table&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">content</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Error&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to establish database connection&quot;</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="c1">### IF DB connection successful, attempt assembling payload</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;### Server: Assembling Payload...&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Message&quot;</span><span class="p">:</span> <span class="s2">&quot;Metadata for Geometry&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;Retrieved&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                   <span class="s2">&quot;Privileges&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">get_privileges</span><span class="p">(),</span>
                   <span class="s2">&quot;Total entities&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">get_count</span><span class="p">(),</span>
                   <span class="s2">&quot;Table attribuets&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">get_attributes</span><span class="p">(),</span>
                   <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">query</span><span class="p">((</span><span class="s1">&#39;srid&#39;</span><span class="p">,</span><span class="mi">4326</span><span class="p">))</span> <span class="c1"># Spatial reference system, Global scope (https://spatialreference.org/ref/epsg/4326/)</span>
                   <span class="p">}</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;### Server: Payload assembled.&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;### Fast Server: Error assembling payload.&quot;</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">JSONResponse</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
            <span class="n">content</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Error&quot;</span><span class="p">:</span> <span class="s2">&quot;Error assembling payload.&quot;</span><span class="p">}</span>
        <span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">operator</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># Closes table instance</span>
        <span class="k">return</span> <span class="n">payload</span></div>

    
<div class="viewcode-block" id="predict_path">
<a class="viewcode-back" href="../backend.html#main.predict_path">[docs]</a>
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/prediction/</span><span class="si">{lon}</span><span class="s2">/</span><span class="si">{lat}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">predict_path</span><span class="p">(</span><span class="n">lon</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lat</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Predicts vessel path based on coordinates.</span>

<span class="sd">    :param lon: Longitude coordinate of the vessel.</span>
<span class="sd">    :param lat: Latitude coordinate of the vessel.</span>
<span class="sd">    :return: Predicted path data as a list of dictionaries.</span>
<span class="sd">    :raises HTTPException: If prediction fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received coordinates - Longitude: </span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s2">, Latitude: </span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># linear_regression.perform_training_manually()</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">linear_regression_2</span><span class="o">.</span><span class="n">perform_vessel_prediction</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predictions</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Ryan Acuna, Seth Johnson, Yolvin Aguirre-Duran, Sean Schoolfield, Oliver Jimenez-Gonzalez.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>